{%- assign lines = page.content | split: "\n" -%}
{%- for line in lines -%}
    {{ line}}
{%-   assign trimmed = line | strip -%}
{%-   assign firstchar = trimmed 
      | slice: 0,1 -%}
{%-   if firstchar == "#" -%}
{%-     assign level = trimmed 
        | split: " " 
        | first 
        | size -%}
{%-     assign text = trimmed 
        | slice: level, trimmed.size -%}
{%-     if text contains "{#" -%}
{%-       assign parts = text 
          | split: "{#" -%}
{%-       assign title = parts[0] 
          | strip -%}
{%-       assign id = parts[1] 
          | split: "}" 
          | first -%}
{%-     else -%}
{%-       assign title = text | strip -%}
{%-       assign id = title
          | downcase
          | replace: " ", "-"
          | replace: ".", ""
          | replace: ",", ""
          | replace: ":", ""
          | replace: "'", ""
          | replace: '"', ""
      -%}
{%-     endif -%}
<p style="padding-left:{{level}}em"><a href="#{{id}}">{{title}}</a></p>
{%-   endif -%}
{%- endfor -%}