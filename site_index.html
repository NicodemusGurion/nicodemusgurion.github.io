---
layout: null
permalink: /site-index/
---
{% assign pages = site.pages | where: "layout", "page" | sort: "url" %}
{% for page in pages %}
  {%- comment -%}
  Compute page depth.
  Root "/" -> 0
  "/foo/" -> 1
  "/foo/bar/" -> 2
  {%- endcomment -%}
  {% assign trimmed_url = page.url | remove_first: "/" | remove: ".html" %}
  {% if trimmed_url == "" %}
    {% assign page_level = 0 %}
  {% else %}
    {% assign page_level = trimmed_url | split: "/" | size %}
  {% endif %}

PAGE | {{ page.url }} | {{ page.title | default: "(no title)" }} | level={{ page_level }}

  {%- comment -%}
  Parse markdown headers from page content
  {%- endcomment -%}
  {% assign lines = page.content | split: "\n" %}
  {% for line in lines %}
    {% assign stripped = line | lstrip %}

    {% if stripped != "" and stripped startswith "#" %}
      {%- comment -%}
      Count header level by number of leading #
      {%- endcomment -%}
      {% assign header_marks = stripped | split: " " | first %}
      {% assign header_level = header_marks | size %}

      {% if header_level >= 1 and header_level <= 6 %}
        {%- comment -%}
        Remove leading #'s and trim
        {%- endcomment -%}
        {% assign header_text = stripped | remove_first: header_marks | strip %}

        {%- comment -%}
        Extract custom ID if present: {#custom-id}
        {%- endcomment -%}
        {% assign header_id = "" %}
        {% if header_text contains "{#" and header_text endswith "}" %}
          {% assign id_part = header_text | split: "{#" | last | remove: "}" %}
          {% assign header_id = id_part %}
          {% assign header_title = header_text | split: "{#" | first | strip %}
        {% else %}
          {% assign header_title = header_text %}
          {% assign header_id = header_title | slugify %}
        {% endif %}

        {% assign total_level = page_level | plus: header_level %}

HEADER | {{ page.url }}#{{ header_id }} | {{ header_title }} | level={{ total_level }}
      {% endif %}
    {% endif %}
  {% endfor %}

{% endfor %}